Поскольку Elasticsearch может масштабироваться горизонтально,
не так сложно сделать правильный выбор. Для начала лучше
выбрать узлы с объемом ОЗУ от 16 до 32 Гбайт и около восьми ядер
ЦП. Как вы увидите в следующих разделах, размер кучи JVM в
Elasticsearch не может превышать 32 Гбайт; следовательно, нет
смысла применять конфигурации с более чем 64 Гбайт ОЗУ.
Рекомендуется использовать твердотельные SSD-диски, если вы
планируете выполнять сложные агрегации

Настройка узлов Elasticsearch
Elasticsearch, который является сердцем Elastic Stack, нуждается в
предварительной настройке. Большинство настроек можно
оставить со стандартными значениями, но есть показатели,
которые необходимо подобрать на уровне ОС или JVM.

Размер кучи JVM
Установите одинаковое значение параметров -Xms и -Xmx.
Больший размер кучи позволит Elasticsearch держать в памяти
больше данных для быстрого доступа к ним. Но есть и обратная
сторона: когда куча JVM будет близка к заполнению, сборщик
мусора JVM начнет полную сборку мусора. В этот момент все
остальные процессы в Elasticsearch будут приостановлены. Чем
больше размер кучи, тем длительнее будет эта пауза.
Максимальный возможный размер кучи составляет около 32 Гбайт.

Не забывайте также, что следует распределить не более чем 50 %
доступного ОЗУ для Elasticsearch JVM. Это делается для того, чтобы
система имела в распоряжении достаточно памяти для работы кэша
файловой системы Apache Lucene. Все данные, хранящиеся в узле
Elasticsearch, рассматриваются как индексы Apache Lucene,
которому необходима ОЗУ для быстрого доступа к файлам.

Таким образом, если вы планируете хранить огромные объемы
данных в Elasticsearch, нет смысла иметь один узел с более чем 64
Гбайт ОЗУ (50 % от которой — 32 Гбайт — максимальный размер
кучи). Рекомендуется добавлять больше узлов, если вы
заинтересованы в масштабировании.

Отключение файла подкачки
При включенном файле подкачки ОС нередко имеет свойство
выгружать память, использованную приложением, на диск, чтобы
другие программы могли задействовать больше ОЗУ.
В узле Elasticsearch это может привести к тому, что ОС начнет
выгружать память кучи Elasticsearch. Такой процесс записи
содержимого ОЗУ на диск с последующей обратной записью с диска
в ОЗУ может замедлить работу. По этой причине следует отключать
файл подкачки в узле Elasticsearch.

Дескрипторы файлов
В операционных системах Linux и macOS ограничено количестводескрипторов открытых файлов, которые может хранить процесс.
Зачастую необходимо увеличивать это ограничение, так как
значение по умолчанию слишком мало для работы Elasticsearch.

Пулы потоков и сборщик мусора
В Elasticsearch предусмотрено много видов операций, таких как
индексирование, поиск, сортировка и агрегации. Кроме того,
система использует пул потоков JVM для выполнения своих задач.
Рекомендуется не менять настройки, связанные с пулами потоков в
Elasticsearch, так как обычно это приводит скорее к негативным
последствиям, нежели к улучшению производительности. Еще
один компонент в Elasticsearch, настройки которого не стоит
менять, — сборщик мусора

Облака
Выбор типа реализации
ЕС2 предлагает разные типы реализаций для различных
требований. Стандартным стартовым выбором для Elasticsearch
считается реализация m3.2xlarge; она имеет восемь ядер ЦП, 30
Гбайт ОЗУ и два твердотельных диска на 80 Гбайт. Рекомендуется
запускать бенчмарки и мониторить нагрузку на ресурсы ваших
узлов. В зависимости от результатов вы можете сужать или
расширять ресурсную базу.

Изменение портов по умолчанию. Не оставляйте порты открытыми!
Запуск любого сервиса в облаке сопряжен с определенными
рисками. Важно учесть, что ни один из портов, используемых
Elasticsearch, не должен быть доступен из Интернета. В ЕС2 вы
можете детально контролировать, какие порты доступны и с каких
IP-адресов или подсетей. В целом нет необходимости открывать
какие-либо порты для доступа извне, кроме порта 22 для
удаленного доступа.
По умолчанию Elasticsearch использует порт 9200 для трафика
HTTP и 9300 — для сообщения между узлами. Рекомендуется
заменить эти порты по умолчанию другими, отредактировав файл
elasticsearch.yml во всех ваших узлах.

Запросы прокси
Используйте обратные прокси, такие как nginx или Apache, для
своих запросов к Elasticsearch/Kibana.

Если вы запускаете Elasticsearch на ЕС2,
имеет смысл хранить снепшоты в сегменте AWS S3.

S3 расшифровывается как Simple Storage Service (простой сервис
хранения). Он может масштабироваться и является надежным
местом для хранения больших объемов данных. Предоставляет
защиту для ваших данных и доступ с многих различных платформ.
S3 соответствует самым строгим требованиям благодаря широким
возможностям обеспечения безопасности. Нередко этот сервис
является самым предпочтительным решением для долгосрочного
хранения данных, особенно когда системы, которые производят эти
данные, размещены на AWS


